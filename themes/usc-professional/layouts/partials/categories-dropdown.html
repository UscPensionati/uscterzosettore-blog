
<div class="dropdown-menu">
  <div class="dropdown-content">
    
    {{/* Iteriamo sulla lista "master" delle categorie da hugo.toml */}}
    {{ range .Site.Params.all_categories.list }}
      {{ $categoryName := .name }}
      {{ $categorySlug := $categoryName | urlize }}
      {{ $categoryURL := printf "/categories/%s/" $categorySlug | relURL }}
      
      {{/* DEBUG: Stampiamo gli URL generati */}}
      <!-- DEBUG: {{ $categoryName }} -> {{ $categorySlug }} -> {{ $categoryURL }} -->
      
      {{/* Contiamo dinamicamente i post per questa categoria - versione robusta */}}
      {{ $categoryPosts := where $.Site.RegularPages "Params.categories" "intersect" (slice $categoryName) }}
      {{ if eq (len $categoryPosts) 0 }}
        {{/* Fallback: prova anche con category singolare */}}
        {{ $categoryPosts = where $.Site.RegularPages "Params.category" $categoryName }}
      {{ end }}
      {{ $categoryCount := len $categoryPosts }}
      
      <div class="category-item">
        <a href="{{ $categoryURL }}" class="category-link">
          <div class="category-info">
            <h4>{{ $categoryName }}</h4>
            <span class="category-count">({{ $categoryCount }})</span>
          </div>
        </a>
      </div>
    {{ end }}

    {{/* Aggiungiamo il link finale per vedere tutte le categorie */}}
    <div class="category-item view-all">
      <a href="{{ "/categories/" | relURL }}" class="category-link">
        <div class="category-info">
          <h4>Mostra Tutte</h4>
        </div>
      </a>
    </div>

  </div>
</div>